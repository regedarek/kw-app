# Production-specific configuration overrides

servers:
  web:
    hosts:
      - 146.59.44.70

proxy:
  ssl: true
  host: nowypanel.kw.krakow.pl

env:
  clear:
    RAILS_ENV: production
    RACK_ENV: production
    POSTGRES_USER: production_user
    POSTGRES_DB: kw_app_production
  secret:
    - RAILS_MASTER_KEY
    - POSTGRES_PASSWORD

ssh:
  user: ubuntu

accessories:
  postgres:
    image: postgres:16.0
    host: 146.59.44.70
    port: "127.0.0.1:5432:5432"
    cmd: postgres
    options:
      network: "kw-app-network"
    env:
      clear:
        POSTGRES_USER: production_user
        POSTGRES_DB: kw_app_production
      secret:
        - POSTGRES_PASSWORD
    files:
      - config/init.sql:/docker-entrypoint-initdb.d/setup.sql
    directories:
      - data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    host: 146.59.44.70
    port: "127.0.0.1:6379:6379"
    options:
      network: "kw-app-network"
    env:
      secret:
        - REDIS_PASSWORD
    cmd: sh -c 'redis-server --requirepass "$$REDIS_PASSWORD" --appendonly yes --dir /data'
    directories:
      - redis-data:/data